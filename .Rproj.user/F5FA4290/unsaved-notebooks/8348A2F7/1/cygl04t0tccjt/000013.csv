"0",""
"0","# Reactive data"
"0","reactive_df <- reactive({"
"0","  df <- retail"
"0","  if (input$region_in != ""All"") df <- df |> dplyr::filter(region == input$region_in)"
"0","  if (input$cat_in    != ""All"") df <- df |> dplyr::filter(category == input$cat_in)"
"0","  df |> dplyr::filter(discount <= input$disc_in)"
"0","})"
"0",""
"0","# downloadHandler must be assigned inside a render* or observer environment"
"0","observe({"
"0","  output$dl_filtered <- downloadHandler("
"0","    filename = function() paste0(""filtered_retail_"", Sys.Date(), "".csv""),"
"0","    content  = function(file) readr::write_csv(reactive_df(), file)"
"0","  )"
"0","})"
"0",""
"0","# Render plot"
"0","renderPlotly({"
"0","  by_region_cur <- reactive_df() |>"
"0","    dplyr::group_by(region) |>"
"0","    dplyr::summarise(sales = sum(sales, na.rm=TRUE), .groups=""drop"")"
"0",""
"0","  p <- ggplot(by_region_cur, aes(x = reorder(region, sales), y = sales)) +"
"0","    geom_col() + coord_flip() +"
"0","    scale_y_continuous(labels = scales::dollar) +"
"0","    labs(title = ""Sales by Region"", x = NULL, y = ""Sales"")"
"0",""
"0","  ggplotly(p)"
"0","})"
"1","<shiny.render.function> 
"
